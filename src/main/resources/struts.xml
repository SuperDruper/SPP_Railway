<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
        "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
        "http://struts.apache.org/dtds/struts-2.3.dtd">

<struts>

    <constant name="struts.enable.DynamicMethodInvocation" value="false"/>
    <constant name="struts.devMode" value="true"/>
    <constant name="struts.convention.default.parent.package" value="angularstruts"/>

    <constant name="struts.mapper.class" value="org.apache.struts2.dispatcher.mapper.Restful2ActionMapper" />

    <constant name="struts.enable.SlashesInActionNames" value="true" />
    <constant name="struts.mapper.alwaysSelectFullNamespace" value="false" />


	
	
    <package name="api" extends="struts-default, json-default" namespace="/api">

        <action name="/user/list/*" class="code.controller.user.UserListShowingAction" method="execute">
            <interceptor-ref name="defaultStack"/>
            <interceptor-ref name="json">
                <param name="enableSMD">true</param>
            </interceptor-ref>

            <result type="json">
                <param name="excludeProperties">
                    <!-- VERY IMPORTANT!!!
                     In action class above there is filed users. Users is list of class User
                     and in User there is Collection named tickets/ You should know that everything that is
                     in Action class serialized in JSON and will be returned in response.
                     But we don't want return and users and tickets list of every user (we don't want to do it
                     in general, and moreover because it throws exception, because Hibernate try
                     to perform lazy loading, and it can't do it, because Session object is already closed).
                     So that is why using this regexp we exclude tickets from serialization.
                     With User.Role.Users situation is the same.-->
                    ^users\[\d+\]\.tickets,
                    ^users\[\d+\]\.role\.users
                </param>
                <param name="noCache">true</param>
            </result>
        </action>

    </package>



    <package name="index" extends="struts-default, json-default">
        <action name="*" class="code.controller.IndexAction">
            <result name="success">/index.jsp</result>
        </action>
    </package>


    <package name="angularstruts" extends="api, index" />
	
    <!--
        <package name="basicstruts2" extends="struts-default">

        <interceptors>
            <interceptor-stack name="appDefault">
                <interceptor-ref name="defaultStack">
                    <param name="exception.logEnabled">true</param>
                    <param name="exception.logLevel">ERROR</param>
                </interceptor-ref>
            </interceptor-stack>
        </interceptors>

        <default-interceptor-ref name="appDefault"/>

        <global-results>
            <result name="error">/error.jsp</result>
            <result name="securityerror">/securityerror.jsp</result>
        </global-results>


        <global-exception-mappings>
            <exception-mapping exception="SecurityBreachException"
                               result="securityerror"/>
            <exception-mapping exception="java.lang.Exception" result="error"/>
        </global-exception-mappings>


        <action name="causesecurityexception" class="RegisterAction"
                method="throwSecurityException">
            <result>/user/register.jsp</result>
        </action>

        <action name="causeexception" class="RegisterAction" method="throwException">
            <result>/user/register.jsp</result>
        </action>

        <action name="causenullpointerexception" class="RegisterAction"
                method="throwNullPointerException">
            <result>/user/register.jsp</result>
        </action>




        <action name="index">
            <result>/index.jsp</result>
        </action>


        <action name="register" class="RegisterAction" method="execute">
            <result name="success">/user/register.jsp</result>
        </action>

        <action name="registerprocess" class="RegisterAction" method="register">
            <result name="success">/index.jsp</result>
            <result name="error">/user/register.jsp</result>
        </action>

        <action name="login" class="LoginAction" method="execute">
            <result name="success">/user/login.jsp</result>
        </action>

        <action name="loginprocess" class="LoginAction" method="execute">
            <result name="success">/user/login.jsp</result>
            <result name="error">/user/register.jsp</result>
        </action>

        <action name="profile" class="ProfileAction" method="execute">
            <result name="success">/user/profile.jsp</result>
        </action>

        <action name="deleteprofile" class="ProfileAction" method="execute">
            <result name="success">/index.jsp</result>
        </action>

        <action name="listusers" class="UserListShowingAction" method="execute">
            <result name="success">/user/listusers.jsp</result>
        </action>



        <action name="actionspecificexception" class="RegisterAction"
                method="throwSecurityException">
            <exception-mapping exception="SecurityBreachException"
                               result="login"/>
            <result>/user/register.jsp</result>
            <result name="login">/user/login.jsp</result>
        </action>

    </package>
     -->

</struts>